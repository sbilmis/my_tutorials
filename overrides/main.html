{% extends "base.html" %}

{# 1. Force mobile responsiveness so text isn't tiny #}
{% block site_meta %}
  {{ super() }}
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
{% endblock %}

{% block content %}
{{ super() }}

<div id="translation-box" style="display:flex; flex-direction:column; align-items:flex-end; gap:5px; position:fixed; bottom:20px; right:20px; z-index:999999;">
    
    <button onclick="closeWidget()" aria-label="Close Translator" style="background:#333; color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; font-weight:bold; font-size:18px; line-height:1; box-shadow:0 2px 5px rgba(0,0,0,0.4); margin-bottom:-10px; z-index:1000000; display:flex; align-items:center; justify-content:center;">
        &times;
    </button>

    <div style="background:white; padding:12px; border-radius:8px; box-shadow:0px 4px 15px rgba(0,0,0,0.2); border: 1px solid #e0e0e0; display:flex; align-items:center; gap:10px;">
        <button onclick="setLanguage('en')" style="background:#f5f5f5; border:1px solid #ccc; padding:8px 12px; border-radius:4px; cursor:pointer; font-size:14px; color:#333; font-weight:bold;">
            ðŸ‡¬ðŸ‡§ English
        </button>
        <button onclick="setLanguage('tr')" style="background:#f5f5f5; border:1px solid #ccc; padding:8px 12px; border-radius:4px; cursor:pointer; font-size:14px; color:#333; font-weight:bold;">
            ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e
        </button>
        <div id="google_translate_element" style="display:none;"></div>
    </div>
</div>

<script type="text/javascript">
  // 1. Check if user previously closed the widget
  if (sessionStorage.getItem('translation-widget-closed') === 'true') {
      document.getElementById('translation-box').style.display = 'none';
  }

  // 2. Initialize Google Translate (Inline Layout to avoid top bar)
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'tr,en',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE, 
      autoDisplay: false
    }, 'google_translate_element');
  }

  // 3. Language Switcher
  function setLanguage(lang) {
      if (lang === 'en') {
          // Clear cookies to reset translation
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=" + window.location.pathname;
          location.reload();
      } else {
          document.cookie = "googtrans=/en/tr; path=/";
          location.reload();
      }
  }

  // 4. Close Widget Function
  function closeWidget() {
      document.getElementById('translation-box').style.display = 'none';
      sessionStorage.setItem('translation-widget-closed', 'true');
  }

  // 5. Prevent Code Blocks from being translated
  document.addEventListener("DOMContentLoaded", function() {
      var codeBlocks = document.querySelectorAll('pre, code, .highlight');
      codeBlocks.forEach(function(block) {
          block.classList.add('notranslate'); 
      });
  });
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<style>
    /* HIDES THE TOP BAR SHOWN IN YOUR SCREENSHOT */
    .goog-te-banner-frame.skiptranslate {
        display: none !important;
    } 
    
    /* MOVES THE WEBSITE BACK TO THE TOP */
    body {
        top: 0px !important; 
        position: static !important; 
    }

    /* HIDES GOOGLE TOOLTIPS */
    .goog-tooltip {
        display: none !important;
    }
    .goog-tooltip:hover {
        display: none !important;
    }
    .goog-text-highlight {
        background-color: transparent !important;
        border: none !important; 
        box-shadow: none !important;
    }

    /* MOBILE ADJUSTMENTS */
    @media (max-width: 480px) {
        #translation-box {
            right: 10px !important;
            bottom: 30px !important; /* Moved up slightly to avoid bottom bezel */
            transform: scale(0.9); 
            transform-origin: bottom right;
        }
    }
</style>

{% endblock %}
