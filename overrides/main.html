{% extends "base.html" %}

{# 1. Strict Mobile Viewport #}
{% block site_meta %}
  {{ super() }}
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
{% endblock %}

{% block content %}
{{ super() }}

<div id="translation-box" style="display:flex; flex-direction:column; align-items:flex-end; gap:5px; position:fixed; bottom:90px; right:20px; z-index:2147483647;">
    
    <button onclick="closeWidget()" aria-label="Close" style="background:#333; color:white; border:none; width:32px; height:32px; border-radius:50%; cursor:pointer; font-weight:bold; font-size:18px; line-height:1; box-shadow:0 2px 8px rgba(0,0,0,0.5); margin-bottom:-12px; z-index:2147483647; display:flex; align-items:center; justify-content:center;">
        &times;
    </button>

    <div style="background:white; padding:12px; border-radius:8px; box-shadow:0px 4px 20px rgba(0,0,0,0.25); border: 1px solid #e0e0e0; display:flex; align-items:center; gap:10px;">
        <button onclick="setLanguage('en')" style="background:#f5f5f5; border:1px solid #ccc; padding:10px 14px; border-radius:4px; cursor:pointer; font-size:14px; color:#333; font-weight:bold;">
            ðŸ‡¬ðŸ‡§ English
        </button>
        <button onclick="setLanguage('tr')" style="background:#f5f5f5; border:1px solid #ccc; padding:10px 14px; border-radius:4px; cursor:pointer; font-size:14px; color:#333; font-weight:bold;">
            ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e
        </button>
        <div id="google_translate_element" style="display:none;"></div>
    </div>
</div>

<script type="text/javascript">
  // 1. Initial Visibility Check
  if (sessionStorage.getItem('translation-widget-closed') === 'true') {
      document.getElementById('translation-box').style.display = 'none';
  }

  // 2. Google Init
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'tr,en',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
      autoDisplay: false
    }, 'google_translate_element');
  }

  // 3. Language Switcher
  function setLanguage(lang) {
      if (lang === 'en') {
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=" + window.location.pathname;
          location.reload();
      } else {
          document.cookie = "googtrans=/en/tr; path=/";
          location.reload();
      }
  }

  // 4. Close Widget
  function closeWidget() {
      document.getElementById('translation-box').style.display = 'none';
      sessionStorage.setItem('translation-widget-closed', 'true');
  }

  // 5. Code Block Protection
  document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll('pre, code, .highlight').forEach(function(block) {
          block.classList.add('notranslate'); 
      });
  });

  // 6. THE NUCLEAR FIX: MutationObserver to delete the Top Bar
  // This watches the page for changes and deletes the Google Frame instantly
  const observer = new MutationObserver(function(mutations) {
      // Find the Google Top Bar Iframe
      const iframe = document.querySelector('.goog-te-banner-frame');
      const frame = document.querySelector('iframe[name="goog-te-banner-frame"]');
      
      if (iframe || frame) {
          if(iframe) iframe.remove();
          if(frame) frame.remove();
          // Force body back to top
          document.body.style.top = '0px';
          document.body.style.position = 'static';
      }
  });

  // Start watching the body for the Google injection
  observer.observe(document.body, { childList: true, subtree: true });
  
  // Also run it once on load just in case
  window.onload = function() {
      document.body.style.top = '0px'; 
  };
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<style>
    /* Hide Google Frame */
    .goog-te-banner-frame, 
    iframe[name="goog-te-banner-frame"] {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
    }
    /* Force Body Position */
    body {
        top: 0px !important; 
        position: static !important; 
    }
    /* Hide Tooltips */
    .goog-tooltip, .goog-tooltip:hover {
        display: none !important;
    }
    .goog-text-highlight {
        background-color: transparent !important;
        border: none !important; 
        box-shadow: none !important;
    }
</style>

{% endblock %}
