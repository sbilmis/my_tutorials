{% extends "base.html" %}

{% block content %}
{{ super() }}

<div id="translation-box" style="position:fixed; bottom:20px; right:20px; z-index:9999; display:flex; flex-direction:column; align-items:flex-end; gap:5px;">
    
    <button onclick="closeWidget()" title="Close Translator" style="background:#333; color:white; border:none; width:24px; height:24px; border-radius:50%; cursor:pointer; font-weight:bold; font-size:14px; line-height:1; box-shadow:0 2px 5px rgba(0,0,0,0.3); margin-bottom:-5px; z-index:10001;">
        &times;
    </button>

    <div style="background:white; padding:10px; border-radius:8px; box-shadow:0px 4px 12px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; display:flex; align-items:center; gap:10px;">
        
        <button onclick="setLanguage('en')" style="background:#f5f5f5; border:1px solid #ddd; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:13px; color:#333; font-weight:bold; font-family:Roboto,sans-serif;">
            ðŸ‡¬ðŸ‡§ English
        </button>

        <button onclick="setLanguage('tr')" style="background:#f5f5f5; border:1px solid #ddd; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:13px; color:#333; font-weight:bold; font-family:Roboto,sans-serif;">
            ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e
        </button>

        <div id="google_translate_element" style="display:none;"></div>
    </div>
</div>

<script type="text/javascript">
  // A. MEMORY CHECK: Hide if user closed it in this session
  if (sessionStorage.getItem('translation-widget-closed') === 'true') {
      document.getElementById('translation-box').style.display = 'none';
  }

  // B. Initialize Google Translate (Hidden)
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'tr,en',
      autoDisplay: false
    }, 'google_translate_element');
  }

  // C. Language Switcher Logic
  function setLanguage(lang) {
      if (lang === 'en') {
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/my_tutorials";
      } else {
          document.cookie = "googtrans=/en/tr; path=/";
      }
      location.reload();
  }

  // D. Close Function WITH MEMORY
  function closeWidget() {
      document.getElementById('translation-box').style.display = 'none';
      // This saves the choice until the browser tab is closed
      sessionStorage.setItem('translation-widget-closed', 'true');
  }

  // E. Safety Shield
  document.addEventListener("DOMContentLoaded", function() {
      var codeBlocks = document.querySelectorAll('pre, code, .highlight');
      codeBlocks.forEach(function(block) {
          block.classList.add('notranslate'); 
      });
  });
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<style>
    .goog-te-banner-frame { display: none !important; }
    body { top: 0px !important; }
</style>

{% endblock %}
